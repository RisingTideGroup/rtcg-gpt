<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Node.js Chatbot</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 80vh;
            overflow-y: scroll;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .message {
            max-width: 70%;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .user {
            align-self: flex-end;
            background-color: #007BFF;
            color: white;
        }

        .bot {
            background-color: #f1f1f1;
            color: black;
        }

        #init-form {
            margin-bottom: 20px;
        }

        #chat-form {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Node.js Chatbot</h1>
    <div id="init-container">
    <form id="init-form">
        <label for="bot-name">Enter the name of the bot:</label>
        <input type="text" id="bot-name" name="bot-name" required>
        <button id="init-button" type="button">Initialize</button>
    </form>
    </div>
    <div id="chat-elements">
    <div id="intro" style="display: none;"></div>
    <div id="chat-container" class="chat-container" style="display: none;"></div>
    <form id="chat-form">
        <input type="text" id="user-message" name="user-message" placeholder="Type your message..." required>
        <button type="submit">Send</button>
    </form>
    </div>

   <script>
  const chatContainer = document.getElementById('chat-container');
  const initElements = document.getElementById('init-container');
  const initButton = document.getElementById('init-button');
  const chatForm = document.getElementById('chat-form');
  const botNameInput = document.getElementById('bot-name');
  const introElements = document.getElementById('intro');
  let chatMessages = [];
  let aiInstruction = '';

  initButton.addEventListener('click', initBot);

  async function initBot() {
    const botName = botNameInput.value;
    initElements.style.display = 'none';
    // botNameInput.value = '';

    // indicate initialization
    const instructionElement = document.createElement('div');
    instructionElement.classList.add('instruction');
    instructionElement.textContent = "Pending AI Initialization... Please Wait ...";
    chatContainer.appendChild(instructionElement);

    // Show chat elements and hide init elements
    chatContainer.style.display = 'block';
    chatForm.style.display = 'block';

    const initResponse = await fetch('/init', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ botName }),
    });

    const initData = await initResponse.json();
    chatMessages = initData.initialMessages;

    instructionElement.textContent = initData.initialMessages[1].content;

    // Show chat elements and hide init elements
    //chatContainer.style.display = 'block';
    
  }

  chatForm.addEventListener('submit', async (event) => {
    event.preventDefault();
    let userMessageInput = document.getElementById('user-message');
    const userMessage = userMessageInput.value;
    userMessageInput.value = '';

    chatMessages.push({ role: 'user', content: userMessage });

    const response = await fetch('/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ chatMessages }),
    });

    const data = await response.json();
    const botMessage = data.botMessage;

    chatMessages.push(botMessage);

    const userMessageElement = document.createElement('div');
    userMessageElement.classList.add('message', 'user');
    userMessageElement.textContent = userMessage;
    chatContainer.appendChild(userMessageElement);

    const botMessageElement = document.createElement('div');
    botMessageElement.classList.add('message', 'bot');
    botMessageElement.textContent = botMessage.content;
    chatContainer.appendChild(botMessageElement);

    chatContainer.scrollTop = chatContainer.scrollHeight;
  });
</script>
</body>
</html>

